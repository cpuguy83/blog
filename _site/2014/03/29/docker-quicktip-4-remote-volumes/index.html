<!DOCTYPE html>
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Docker Quicktip #4 - Remote volumes &middot; Container42
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Container42</a>
            <small>Stuff I find interesting</small>
          </h3>
            <span display="float:right">
              <a href="https://twitter.com/cpuguy83"><small>Twitter</small></a>
              <a href="https://github.com/cpuguy83"><small>GitHub</small></a>
            </span>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Docker Quicktip #4 - Remote volumes</h1>
  <span class="post-date">29 Mar 2014</span>
  <p>This one builds off the idea of using <a href="http://www.tech-d.net/2013/12/16/persistent-volumes-with-docker-container-as-volume-pattern/" title="Persistent volumes with Docker â€“ Data-only container pattern">data-only containers</a>.  Let&#39;s step into the unknown and add a second host into the mix.</p>

<p>What do you use when you need to share data with containers across hosts?
The answer?  Well... as you normally would... NFS (or insert your file share service of choice).</p>

<!--break-->

<p>First, let&#39;s startup an NFS server... <a href="https://index.docker.io/u/cpuguy83/nfs-server/">it just so happens I created an image for just this purpose</a>.  You should check out the github repo if you want the details in how it works... but essentially all you need to do is add each directory you want to to the end of your run command.
** I should note, this nfs server is not secured or optimized, use at your own risk **</p>

<p><code>docker run -d --name nfs --privileged cpuguy83/nfs-server /tmp /home</code></p>

<p>Here, the <code>/tmp</code> folder and the <code>/home</code> folder are being shared by NFS.  You can add however many dirs you want, but they must exist on the server.</p>

<p>Now let&#39;s fire up the nfs client:</p>

<p><code>docker run -d --link nfs:nfs --privileged -v /mnt cpuguy83/nfs-client /home:/mnt</code></p>

<p>Here, you specify the s source mount and the mount point in the container as /path/in/server:/mount/to/here.  So <code>/home</code> on the nfs-server is mounted to <code>/mnt</code> on the client.
We are also linking the containers, what&#39;s important is that the internal side is called nfs as we are using the env var generated by this link to get the IP of the nfs server.
Now, links don&#39;t currently work across docker hosts, so what good does this do?  Not much locally (no point in using NFS on a single host)... but you can either use the ambassador pattern or manually provide the env var in the run command (<code>NFS_PORT_2049_TCP_ADDR</code>) with the IP of the nfs server when doing multi-host.</p>

<p>When you combine this with using volumes-from things begin to get a bit more powerful.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># NFS Server</span>
docker run -d -v /tmp ubuntu --name foo bash -c <span class="s2">&quot;echo foo &amp;gt; /tmp/foo&quot;</span>
docker run -d --name nfs-server --privileged --volumes-from foo cpuguy83/nfs-server /tmp
docker inspect --format <span class="s1">&#39;&#39;</span> nfs-server
10.0.1.100
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Remote NFS Client</span>
docker run -d --name nfs-client --privileged -e <span class="nv">NFS_PORT_2049_TCP_ADDR</span><span class="o">=</span>10.0.1.100 -v /tmp cpuguy83/nfs-client /tmp:/tmp
docker run --rm --volumes-from nfs-client ubuntu cat /tmp/foo
foo
</code></pre></div>
<p>You&#39;ll notice you must use <code>--privileged</code> for both the nfs-server and client.  In the (near) future Docker will have finer grained control of the capabilities available to a specific container and we can just add the required ones here instead of opening up the full <code>--privileged</code>.</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/03/27/docker-quicktip-7-psformat/">
            Docker Quicktip #7: docker ps --format
            <small>27 Mar 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/10/30/docker-networking-reborn/">
            Docker Networking: Reborn
            <small>30 Oct 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/09/15/experimenting-with-native-docker-tooling/">
            Experimenting with Native Docker tooling
            <small>15 Sep 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'tech-d'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



      </div>
    </div>

  </body>
</html>
